class c{constructor(e){this.el=e,this.markers=[],this.mapEl=this.el.querySelector(".otomaties-store-locator__map"),this.filtersEl=this.el.querySelector(".otomaties-store-locator__filters"),this.openWindow=null,this.options={zoom:parseInt(e.getAttribute("data-zoom"))},this.renderMap(),this.bindEvents()}getMarkersFromHtml(){let e=[];const o=this.mapEl.querySelectorAll(".store");return Array.from(o).forEach(t=>{const s=t.getAttribute("data-lat"),r=t.getAttribute("data-lng");e.push({latLng:new google.maps.LatLng(s,r),title:t.getAttribute("data-title"),content:t.innerHTML,icon:t.getAttribute("data-marker"),categories:t.getAttribute("data-categories").split(",").map(Number)})}),e}renderMap(){const e=this.getMarkersFromHtml();this.map=new google.maps.Map(this.mapEl,{zoom:this.options.zoom,center:new google.maps.LatLng(50.85045,4.34878),mapTypeId:google.maps.MapTypeId.ROADMAP});let o=this;for(let t=0;t<e.length;t++){let s=new google.maps.Marker({position:e[t].latLng,icon:e[t].icon?e[t].icon:null,map:this.map,categories:e[t].categories});const r=new google.maps.InfoWindow;google.maps.event.addListener(s,"click",function(a,l){return function(){o.openWindow&&o.openWindow.close(),r.setContent(e[l].content),r.setOptions({minWidth:250,maxWidth:350,minHeight:350}),r.open(this.map,a),o.openWindow=r}}(s,t)),this.markers.push(s)}this.centerMap()}centerMap(){let e=this.markers.filter(s=>s.map!==null);e.length||(e=this.markers);for(var o=new google.maps.LatLngBounds,t=0;t<e.length;t++){const s=e[t].position;o.extend(s)}e.length>1?this.map.fitBounds(o):this.map.setCenter(o.getCenter())}bindEvents(){this.filtersEl.addEventListener("change",()=>{const e=this.filtersEl.querySelectorAll('input[type="checkbox"]'),o=Array.from(e).filter(t=>t.checked).map(t=>parseInt(t.value));this.filter(o)})}filter(e){for(let o=0;o<this.markers.length;o++)!e.length||this.markers[o].categories.filter(t=>e.includes(t)).length?this.markers[o].setMap(this.map):this.markers[o].setMap(null);this.centerMap()}}const n=document.querySelectorAll(".otomaties-store-locator");n.length&&n.forEach(i=>{new c(i)});
